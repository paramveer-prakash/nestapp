# NestApp API Project 

This is a nestjs based API project which integrates Github APIs to retrieve the repositories of a user.
- For a given username and header “Accept: application/json”, it retrieves the github repositories which are not forked.
- Output of the successful execution of API has following information:
``` sh
{
    "repositories": [
            {
                "branches": [
                    {
                        "name": "branch1",
                        "sha": "a4aa5b0a4373ff39067882eb20aee41a27a1afdc"
                    },
                    {
                        "name": "branch2",
                        "sha": "79d5ca4ac234409eb840c2a8df9211b85d80feaf"
                    },
                    {
                        "name": "main",
                        "sha": "a4aa5b0a4373ff39067882eb20aee41a27a1afdc"
                    }
                ],
                "name": "repo1",
                "ownerLogin": "username"
            },
            {
                "branches": [
                    {
                        "name": "main",
                        "sha": "0ad269dc248ac56e4be729869ff97cf753cabf44"
                    }
                ],
                "name": "repo2",
                "ownerLogin": "username"
            }
        ]
}
```

- If the user doesn't exist in github for the given username, then returns 404 response in below a format
``` sh
{
    "status": 404,
    "message": "User does not exist"
}
```
- If the given header value for Accept is not empty and not equal to application/json then api returns 406 response in below format
``` sh
{
    "status": 406,
    "message": "Unsupported value for header [Accept]"
}
```

## 1. Getting started

### 1.1 Requirements

Before starting, make sure you have at least those components on your workstation:
- An up-to-date release of [NodeJS](https://nodejs.org/) and NPM

### 1.2 Project configuration
Start by cloning this project on your workstation.

``` sh
git clone <TBD URL> nestapp
```

The next thing will be to install all the dependencies of the project.

```sh
cd ./nestapp
npm install
npm run start
```

Once server is started, swagger api url should be accessible at http://localhost:3000/api . There you can play with API 

## 2. Project structure
```sh
nestapp
├──src/
│   ├── modules
│   │   ├── core  # The purpose of is to containe exception filters, guards, logger etc which are common all other modules and used in the whole application
│   │   │   ├── exception 
│   │   │   │   ├── api-exception-filter.spec.ts
│   │   │   │   ├── api-exception-filter.ts
│   │   │   │   └── exception-constants.ts
│   │   │   ├── guard
│   │   │   │   ├── request-headers.guard.spec.ts
│   │   │   │   └── request-headers.guard.ts
│   │   │   ├── logging
│   │   │   │   ├── apilogger.spec.ts
│   │   │   │   └── apilogger.ts
│   │   │   └── core.module.ts
│   │   ├── ext-services  # ext-services module contains services/provider which communicate to external systems (github in our case).  
│   │   │   ├── scmservice
│   │   │   │   ├── constants
│   │   │   │   │   └── scm.constants.ts
│   │   │   │   ├── exceptions
│   │   │   │   │   └── usernotfoundexception.ts
│   │   │   │   ├── model
│   │   │   │   │   ├── branch.ts
│   │   │   │   |   ├── repo.ts
│   │   │   │   │   ├── userrepositories.ts
│   │   │   │   ├── scm.service.spec.ts
│   │   │   │   └── scm.service.ts
│   │   │   └── ext-services.module.ts
│   │   ├── user  # user module contains the controller and its services which uses ext-services module's services to fetch the data from external systems.
│   │   │   ├── controller
│   │   │   │   └── user.controller.spec.ts
│   │   │   │   └── user.controller.ts
│   │   │   ├── service
│   │   │   │   └── user.service.spec.ts
│   │   │   │   └── user.service.ts
│   │   │   └── user.module.ts
│   │   └── app.module.ts
│   └── main.ts
│   test/
│   ├── app.e2e-spec
├── cloudformation-ecs.yaml # cloud formation template for provisioning aws resources for nestapp project deployment
├── Dockerfile # docker file for containerizing the nestapp project
├── Jenkinsfile # jenkins pipeline for CI/CD tasks
├── swagger.yaml # swagger yaml file for API specs
```

## 3. NPM commands

The NPM commands below can be used to quickly run, build and test the nestapp api project.

```sh
# Start the application
npm run start

# Run the project' functional tests
npm run test

# Run the project' integration tests
npm run test:e2e


## 4. Swagger UI
Once the project is started, swagger UI can be accessed at http://localhost:3000/api
```

## 4. CI/CD
### 4.1 Docker
- Docker image can be generated by running **docker build -t nestapp .**

### 4.2 Cloud formation
- Aws resources can be provisioned with the help cloud formation template file **cloudformation-ecs.yaml**
- On successful execution of cloud formation template various resources including VPC, ECS Cluster, ECS Service, API Gateway, CloudMap Registry will be created as part of stack.
- SwaggerUI url can be obtained from Output section of cloudformation stack. eg url : https://nmtg0dn2r9.execute-api.ap-south-1.amazonaws.com/api/

### 4.3 Jenkins
- Jenkins pipeline can be configured with the help of **Jenkinsfile** file.
- jenkins pipeline contains the stages to checkout the code followed by building docker images followed by deployment of cloudformation stack on aws.


